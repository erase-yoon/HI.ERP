package com.naver.erp;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

// [서비스 클래스]에는 @Service와 @Transactional을 붙인다.
// @Service : [서비스 클래스]임을 지정하고 
// 스프링이 이 객체를 관리하도록 등록된다.
@Service
// @Transactional : [서비스 클래스]의 
// 메소드 내부에서 일어나는 모든 작업에는 [트랜잭션]이 걸린다.
@Transactional

// [서비스 클래스]인 [BoardServiceImpl 클래스 선언]
public class BoardServiceImpl implements BoardService{

	// boardDAO 속성변수에
	// BoardDAO 인터페이스를 구현한 클래스를 객체화 하여
	// 객체의 메모리 위치 주소 값을 저장한다.
	@Autowired
	private BoardDAO boardDAO;
	// Autowired로 [ = new ~;]을 생략하고 선언하면
	// BoardDAO 인터페이스를 구현할 클래스를 찾을 때(호출할 때?)
	// 그 클래스의 이름은 무엇이든 상관없다.
	// 단 BoardDAO 인터페이스를 구현한 클래스는 1개만 생성해야 한다.
	
	// [1개의 게시판 글]을 리턴하는 메소드 선언
	public BoardDTO getBoard(int b_no, boolean isBoardDetailForm) {
		
		if(isBoardDetailForm==true) {
			// [BoardDAOImpl 객체]의 updateReadcount 메소드를 호출하여
			// [조회수 증가] 작업 후 수정한 행의 개수를 얻는다.
			int updatecount = this.boardDAO.updateReadcount(b_no);
			
			if(updatecount==0) {
				return null;
			}
		}

		// [BoardDAOImpl 객체]의 getBoard 메소드를 호출하여
		// [1개의 게시판 글]을 얻는다.
		BoardDTO board = this.boardDAO.getBoard(b_no);
		
		return board;
	}
	
	// [1개의 게시판 글]을 수정하고
	// 수정 적용행의 개수를 리턴하는 메소드 선언
	public int updateBoard(BoardDTO boardDTO) {
		
		// 수정할 게시판의 개수 얻기
		int boardCnt = this.boardDAO.getBoardCnt(boardDTO.getB_no());
		System.out.println("getB_no : " + boardDTO.getB_no());
		if(boardCnt==0) {
			return 0;
		}
		
		// 암호의 존재 개수 얻기
		int boardPwdCnt = this.boardDAO.getBoardPwdCnt(boardDTO);
		
		if(boardPwdCnt==0) {
			return -1;
		}
		
		// 수정 실행 후 수정 적용행의 개수 얻기
		int updateBoardCnt = this.boardDAO.updateBoard(boardDTO);
		
		// 수정 실행하고 수정 적용행의 개수 리턴
		return updateBoardCnt;
	}

}
