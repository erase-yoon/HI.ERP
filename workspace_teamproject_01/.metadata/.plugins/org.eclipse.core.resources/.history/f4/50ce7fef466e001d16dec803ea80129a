package com.kh.erp.ad.notice;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

// [서비스 클래스]에는 @Service와 @Transactional을 붙인다.
// @Service : [서비스 클래스]임을 지정하고 
// 스프링이 이 객체를 관리하도록 등록된다.
@Service
// @Transactional : [서비스 클래스]의 
// 메소드 내부에서 일어나는 모든 작업에는 [트랜잭션]이 걸린다.
@Transactional

// [서비스 클래스]인 [AdNoticeServiceImpl 클래스 선언]
public class AdNoticeServiceImpl implements AdNoticeService{

	// AdNoticeDAO 속성변수에
	// AdNoticeDAO 인터페이스를 구현한 클래스를 객체화 하여
	// 객체의 메모리 위치 주소 값을 저장한다.
	@Autowired
	private AdNoticeDAO adNoticeDAO;
	// Autowired로 [ = new ~;]을 생략하고 선언하면
	// AdNoticeDAO 인터페이스를 구현할 클래스를 찾을 때(호출할 때?)
	// 그 클래스의 이름은 무엇이든 상관없다.
	// 단 AdNoticeDAO 인터페이스를 구현한 클래스는 1개만 생성해야 한다.
	
	// [1개의 게시판 글]을 리턴하는 메소드 선언
	public AdNoticeDTO getAdNotice(int b_no, boolean isAdNoticeDetailForm) {
		
		if(isAdNoticeDetailForm==true) {
			// [AdNoticeDAOImpl 객체]의 updateReadcount 메소드를 호출하여
			// [조회수 증가] 작업 후 수정한 행의 개수를 얻는다.
			int updatecount = this.adNoticeDAO.updateReadcount(b_no);
			
			if(updatecount==0) {
				return null;
			}
		}

		// [AdNoticeDAOImpl 객체]의 getAdNotice 메소드를 호출하여
		// [1개의 게시판 글]을 얻는다.
		AdNoticeDTO getAdNotice = this.adNoticeDAO.getAdNotice(b_no);

		return getAdNotice;
	}
	
	// [1개의 게시판 글]을 입력하고
	// 입력 적용행의 개수를 리턴하는 메소드 선언
	public int insertAdNotice(AdNoticeDTO AdNoticeDTO) {
		
		//  만약 엄마글의 글 번호가 있으면 댓글쓰기 이므로
		//  엄마 글 이후의 게시판 글에 대해 출력순서번호를 1 증가 시키기.
		if(AdNoticeDTO.getB_no()>0) {
			
			this.adNoticeDAO.updatePrintNoCnt(AdNoticeDTO);
//			int updatePrintNoCnt = this.adNoticeDAO.updatePrintNoCnt(AdNoticeDTO);
		}

		// AdNoticeDAOImpl 객체의  insertAdNotice 메소드 호출하여 게시판 글 입력 후 입력 적용 행의 개수 얻기
		int AdNoticeRegCnt = this.adNoticeDAO.insertAdNotice(AdNoticeDTO);
				
		// 입력 적용행의 개수 리턴
		return AdNoticeRegCnt;
	}

	
	// [1개의 게시판 글]을 수정하고
	// 수정 적용행의 개수를 리턴하는 메소드 선언
	public int updateAdNotice(AdNoticeDTO AdNoticeDTO) {

		// 수정할 게시판의 개수 얻기
		int AdNoticeCnt = this.adNoticeDAO.getAdNoticeCnt(AdNoticeDTO.getB_no());
		if(AdNoticeCnt==0) {
			return 0;
		}
		
		// 암호의 존재 개수 얻기
		int AdNoticePwdCnt = this.adNoticeDAO.getAdNoticePwdCnt(AdNoticeDTO);
		if(AdNoticePwdCnt==0) {
			return -1;
		}
		
		// 수정 실행 후 수정 적용행의 개수 얻기
		int updateAdNoticeCnt = this.adNoticeDAO.updateAdNotice(AdNoticeDTO);
		
		// 수정 적용행의 개수 리턴
		return updateAdNoticeCnt;
	}
	
	// [1개의 게시판 글]을 삭제하고
	// 삭제 적용행의 개수를 리턴하는 메소드 선언
	public int deleteAdNotice(AdNoticeDTO AdNoticeDTO) {

		// 삭제할 게시판의 개수 얻기
		int AdNoticeCnt = this.adNoticeDAO.getAdNoticeCnt(AdNoticeDTO.getB_no());
		if(AdNoticeCnt==0) {
			return 0;
		}
		
		// 암호의 존재 개수 얻기
		int AdNoticePwdCnt = this.adNoticeDAO.getAdNoticePwdCnt(AdNoticeDTO);
		if(AdNoticePwdCnt==0) {
			return -1;
		}
		
		// [AdNoticeDAOImpl 객체]의 getAdNoticeChildrenCnt 메소드를 호출하여
		// [삭제할 게시판의 자식 글의 존재개수]를 얻는다.
		int getAdNoticeChildrenCnt = this.adNoticeDAO.getAdNoticeChildrenCnt(AdNoticeDTO);
		if(getAdNoticeChildrenCnt>0) {
			
			// 수정 실행 후 수정 적용행의 개수 얻기
			// 답글이 있을 경우 제목, 내용을 지우는 메소드를 호출하여
			// 글의 제목, 내용 삭제
			this.adNoticeDAO.updateAdNoticeEmpty(AdNoticeDTO);
//			int updateAdNoticeEmpty = this.adNoticeDAO.updateAdNoticeEmpty(AdNoticeDTO);
			
			return -2;
		}
		
		// 삭제될 게시글의 동생 글의 출력순서 번호를 1씩 감소시키기
		this.adNoticeDAO.updatePrintNoDown(AdNoticeDTO);
//		int updatePrintNoDownCnt = this.adNoticeDAO.updatePrintNoDown(AdNoticeDTO);
		
		// 삭제 실행 후 삭제 적용행의 개수 얻기
		int deleteAdNoticeCnt = this.adNoticeDAO.deleteAdNotice(AdNoticeDTO);
		
		// 삭제 적용행의 개수 리턴
		return deleteAdNoticeCnt;
	}

}
