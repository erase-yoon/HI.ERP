package com.naver.erp;

import java.util.HashMap;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.servlet.ModelAndView;

// ---------------------------------------------------------------
// URL 주소로 접속하면 호출되는 자격을 가진
// 메소드를 소유한 [컨트롤러 클래스] 선언
// ---------------------------------------------------------------
// 관용적으로 Controller가 들어간 클래스는
// URL 주소 접속 시에 대응하여 호출되는 메소드를 소유하고 있다.
// 클래스의 이름 앞에는 @Controller 어노테이션이 붙는다.
// ---------------------------------------------------------------
// @Controller라는 어노테이션을 붙임으로서
// 스프링 프레임 워크가 객체를 생성하고 관리하고
// [컨트롤러 클래스]임이 지정된다.
// ---------------------------------------------------------------
@Controller
public class LoginController {
	
	// loginDAO 속성변수에
	// LoginDAO 인터페이스를 구현한 클래스를 객체화 하여
	// 객체의 메모리 위치 주소 값을 저장한다.
	@Autowired
	private LoginDAO loginDAO;
	// LoginDAO 인터페이스를 구현할 클래스를 찾을 때(호출할 때?)
	// 그 클래스의 이름은 무엇이든 상관없다.
	// 단 LoginDAO 인터페이스를 구현한 클래스는 1개만 생성해야 한다.
	
	// <참고> 관용적으로 클래스 이름에 DAO가 있으면 
	// 직접 DB연동을 하는 메소드를 소유한 클래스이다.
	
	// ---------------------------------------------------------------
	// 가상 URL 주소 /loginForm.do로 접근하면 호출되는 메소드 선언
	// ---------------------------------------------------------------
	// URL 주소에 대응하여 호출되려면 메소드 앞에
	// @RequestMapping(value="가상 URL 주소")라는 어노테이션이 붙어야 한다.
	
	// <주의> @RequestMapping이 붙은 메소드의 이름은 원하는 명칭으로 설정 가능하다.
	// 보통 URL 주소의 의도를 살리는 메소드 이름으로 설정하는 것이 좋다.
	
	// @RequestMapping이 붙은 메소드의 특징
	// - 가상 URL 주소로 접근하면 호출된다.
	// - 메소드의 리턴형이 ModelAndView 객체일 경우
	// DB 연동 결과물과 호출할 JSP 페이지명이 저장되어 있다.
	// 필수 입력 : 호출할 JSP 페이지명
	// 선택 입력 : DB 연동 결과물
	// - DB 연동 결과물은 HttpServletRequest 객체에도 저장된다.
	// - 메소드 호출 후 ModelAndView 객체가 리턴되면
	// 스프링 프레임 워크는 ModelAndView 객체에 저장된 JSP를 호출한다.
	// - JSP가 호출된 후 생성되는 HTML이 웹 브라우저 쪽으로
	// 전송, 실행 되어 결과물을 보게 된다.
	// - JSP 페이지의 역할은 HttpServletRequest 객체에 저장된 데이터를 꺼내
	// JSP 페이지의 HTML 또는 JS 코드 사이에 삽입하는 것이다.
	@RequestMapping(value="/loginForm.do")
	public ModelAndView loginForm() {
		
		// [ModelAndView 객체] 생성
		ModelAndView mav = new ModelAndView();
		
		// [ModelAndView 객체]의
		// setViewName 메소드를 호출하여
		// [호출할 JSP 페이지명]을 문자로 저장
		// [호출할 JSP 페이지명] 앞, 뒤에 붙는 위치 경로 및 확장자는
		// application.properties에서 
		// spring.mvc.view.prefix=위치 경로
		// spring.mvc.view.suffix=확장자
		// 로 설정 가능하다.
		// <참고> 기본 저장 경로에서 webapp까지는 설정되어 있다.
		mav.setViewName("loginForm.jsp");
		
		// [ModelAndView 객체] 리턴
		return mav;
	}

	// ---------------------------------------------------------------
	// 가상주소 /loginProc.do 접근 시 호출되는 메소드 선언
	// ---------------------------------------------------------------
	// @RequestMapping(~, produces="application/json;charset=UTF-8")와
	// @ResponseBody 설정 시 리턴 데이터가 클라이언트에게 전송된다.
	// @RequestMapping, @ResponseBody 설정 시 
	// 리턴 데이터가 JSON 형태로 응답메시지에 저장되어 전송된다.
	@RequestMapping(value="/loginProc.do", method=RequestMethod.POST, produces="application/json;charset=UTF-8")
	@ResponseBody
	public int loginProc(@RequestParam(value="mid") String mid, @RequestParam(value="pwd") String pwd){
	// "mid"라는 파라미터 명에 해당하는 파라미터 값을 꺼내 String mid에 저장
	// "pwd"라는 파라미터 명에 해당하는 파라미터 값을 꺼내 String pwd에 저장
		
		// HashMap 객체 생성 후 객체의 메모리 위치 주소 값을 map에 저장
		// HashMap 객체에는 매개변수로 들어온 데이터(아이디, 암호 등)를 저장할 예정이다.
		Map<String, String> map = new HashMap<String, String>();
		
		// 매개변수로 들어온 [로그인 아이디]를 HashMap 객체에 저장
		map.put("mid", mid);
		
		// 매개변수로 들어온 [로그인 암호]를 HashMap 객체에 저장
		map.put("pwd", pwd);
		
		// ---------------------------------------------------------------
		// [로그인 아이디]와 [로그인 암호]의 DB 존재 개수를
		// 저장할 변수 loginIdCnt 선언하고
		// LoginDAOImpl 객체의 getCntLogin 메소드를 호출하여 얻은 데이터 저장
		// ---------------------------------------------------------------
		// 이 메소드는 [로그인 아이디]와 [로그인 암호]의 DB 존재 개수를 구해주는 메소드이다.
		// 이 메소드 호출 시 매개변수로 던져지는 HashMap 객체에는 
		// [로그인 아이디]와 [로그인 암호]가 저장되어 있다.
		int loginIdCnt = loginDAO.getCntLogin(map);
		
		return loginDAO.getCntLogin(map);
		
	}

}
